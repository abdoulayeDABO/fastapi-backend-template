# user nginx;
# worker_processes auto;
# pid /run/nginx.pid;


# events {
#     worker_connections 1024;
# }

# http {
#     # Cache
#     proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=my_cache:10m max_size=1g inactive=60m use_temp_path=off;

#     # Performance
#     sendfile on;
#     tcp_nopush on;
#     tcp_nodelay on;
#     keepalive_timeout 65;
#     types_hash_max_size 2048;

#     # MIME types
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;

#     # SSL
#     # ssl_session_cache shared:SSL:10m;
#     # ssl_session_timeout 10m;
#     # ssl_protocols TLSv1.2 TLSv1.3;
#     # ssl_ciphers EECDH+AESGCM:EDH+AESGCM;
#     # ssl_prefer_server_ciphers on;
#     # ssl_verify_client off;

#     # Security headers
#     server_tokens off;
#     add_header X-Frame-Options "SAMEORIGIN" always;
#     add_header X-XSS-Protection "1; mode=block" always;
#     add_header X-Content-Type-Options "nosniff" always;
#     add_header Referrer-Policy "no-referrer-when-downgrade" always;
#     add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

#     # Logs
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     ##
#     # Gzip Settings
#     ##
#     gzip on;
#     gzip_vary on;
#     gzip_proxied any;
#     gzip_comp_level 6;
#     gzip_buffers 16 8k;
#     gzip_http_version 1.1;
#     gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

#     ##
#     # Virtual Host Configs
#     ##
#     include /etc/nginx/conf.d/*.conf;
#     include /etc/nginx/sites-enabled/*;


#     # Redirect HTTP to HTTPS
#     server {
#         listen 80;
#         server_name www.example.com;
#         return 301 https://$host$request_uri;
#     }

#     # HTTPS server
#     server {
#         listen 443 ssl;
#         server_name www.example.com;

#        # Let's Encrypt
#         ssl_certificate /etc/letsencrypt/live/www.example.com/fullchain.pem;
#         ssl_certificate_key /etc/letsencrypt/live/www.example.com/privkey.pem;

#         # OU Certificat auto-signé (à utiliser uniquement en développement)
#         # ssl_certificate /etc/nginx/ssl/www.example.com.crt;
#         # ssl_certificate_key /etc/nginx/ssl/www.example.com.key;

#         # Proxy settings for API
#         location /api/v1/ {
#             proxy_pass http://backend:8000/api/v1/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;

#             proxy_cache my_cache;
#             proxy_cache_valid 200 302 10m;
#             proxy_cache_valid 404 1m;
#         }

#         # root for static files
#         root /usr/share/nginx/html;

#         # Serve static files
#         location / {
#             index index.html index.htm;
#             try_files $uri $uri/ =404;
#         }


#         # Custom error pages
#         error_page 404 /404.html;
#         location = /404.html {
#             internal;
#         }

#         error_page 500 502 503 504 /50x.html;
#         location = /50x.html {
#             internal;
#         }

#         # Les urls contennant /. (dotfiles)
#         location ~ /\. {
#             deny all;
#             access_log off;
#             log_not_found off;
#         }
#     }
# }



# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name www.example.com;
    return 301 https://$host$request_uri;
}

# HTTPS server
server {
    listen 443 ssl;
    server_name www.example.com;

    # Let's Encrypt
    # ssl_certificate /etc/letsencrypt/live/www.example.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/www.example.com/privkey.pem;

    # Auto-signed certificate (to be used only in development)
    ssl_certificate /etc/nginx/ssl/www.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/www.example.com.key;

    # Proxy settings for API
    location /api/v1/ {
        proxy_pass http://backend:8000/api/v1/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # root for static files
    # root /usr/share/nginx/html;

    # Serve static files
    # location / {
    #     index index.html index.htm;
    #     try_files $uri $uri/ =404;
    # }


    # Custom error pages
    error_page 404 /404.html;
    location = /404.html {
        internal;
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        internal;
    }

    # Les urls contennant /. (dotfiles)
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}
